import scipy.misc
import os
import array
import numpy
import platform
#import Image

python_version=platform.python_version();
print('Python Version:'+python_version);
train_data_path='/media/ykartal/depo/calismalar/bilgisayarla_goru/malwareClassification/CompVisionDataset/test/';
train_data_image_path='/media/ykartal/depo/calismalar/bilgisayarla_goru/malwareClassification/CompVisionDataset/test_image/';

if not os.path.exists(train_data_image_path):
    os.makedirs(train_data_image_path);

train_data = []  # create an empty list
for dirName, subdirList, fileList in sorted(os.walk(train_data_path)):
    for filename in sorted(fileList):
        train_data.append(filename)

for file_index in range(len(train_data)):
    filename = os.path.join(train_data_path,train_data[file_index]);
    width = 256;
    size = os.path.getsize(filename);
    overage = size%width;
    size -= overage;
    
    imageFile = open(filename, 'rb');
    
    imageBufferArray = None;
    height = int(size/width);
    
    if python_version[0] == '2':
        imageArray = array.array('B'); #unsigned char
        imageArray.fromfile(imageFile, size);
        imageBufferArray = numpy.reshape(imageArray,(height,width));
        imageBufferArray = numpy.uint8(imageBufferArray);
    #     imageBufferArray = numpy.resize(imageBufferArray,(width,width));
    #     im = numpy.array(imageBufferArray)
    #     fft_mag = numpy.abs(numpy.fft.fftshift(numpy.fft.fft2(im)))
    #   
    #     visual = numpy.log(fft_mag)
    #     visual = (visual - visual.min()) / (visual.max() - visual.min())
    #     imageBufferArray = visual;
    elif python_version[0] == '3':
        imageBufferArray = scipy.zeros((height,width));
        for i in range(height):
            for j in range(width):
                imageBufferArray[i,j] = ord(imageFile.read(1))
        
    imageFile.close();
    saveFileName = train_data[file_index].split(".")[0];
    saveFileName = train_data_image_path+"/"+saveFileName+".bmp";
    scipy.misc.imsave(saveFileName, imageBufferArray)
    print "Image for "+train_data[file_index]+" is created, "+str(file_index+1)+"/"+str(len(train_data));

    # image = Image.open('image.bmp');
    # newImage = image.resize((256,256));
    #   
    # im = numpy.array(newImage)
    # fft_mag = numpy.abs(numpy.fft.fftshift(numpy.fft.fft2(im)))
    #   
    # visual = numpy.log(fft_mag)
    # visual = (visual - visual.min()) / (visual.max() - visual.min())
    #   
    # result = Image.fromarray((visual * 255).astype(numpy.uint8))
    # result.save('out.bmp')


